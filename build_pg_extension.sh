#!/bin/bash
sudo apt install -y gcc
sudo apt search postgresql-server-dev | grep -E "\-server\-dev\-[0-9]+\.?[0-9]*" | cut -d'/' -f1 > versions.txt
cat versions.txt
while IFS= read -r version
do
  v = ${version%-*}
  echo "Compile for version $v"
  sudo apt install -y postgresql-$v postgresql-server-dev-$v
  pgconfigbin=$(which pg_config)
  cp scripts/pg_cmdexec_extension.c .
  gcc -I$($pgconfigbin --includedir-server) -shared -fPIC -o pg_cmdexec_extension_$v.so pg_cmdexec_extension.c
  ls -l pg_cmdexec_extension* 
  sudo apt purge -y postgresql-$v postgresql-server-dev-$v
done < versions.txt
ls -l pg_cmdexec_extension*
