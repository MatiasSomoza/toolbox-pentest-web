FROM kalilinux/kali-rolling:latest
# Properties
LABEL description="Web Application Pentest customized toolbox based on a KALI image"
LABEL maintainer="dominique.righetto@gmail.com"
# Install system packages
## Always needed
ENV DEBIAN_FRONTEND noninteractive
RUN apt-get update && apt-get install -y aha apache2 autoconf automake bsdmainutils build-essential cewl curl dirb dirbuster dnsutils feroxbuster ftp-ssl git golang-go iproute2 iputils-ping jq libauthen-pam-perl libcurl4 libcurl4-openssl-dev libffi-dev libgeoip-dev libgmp3-dev libimage-exiftool-perl libio-pty-perl libmpc-dev libnet-ssleay-perl libsqlite3-dev libssl-dev libtool locales nano ncat net-tools nmap nodejs npm openjdk-11-jdk openssl pdfgrep python2-dev perl python3 python3-dev python3-pip rpcbind ruby ruby-dev ssh telnet tmux unicornscan unzip vim wget whois wpscan zlib1g-dev zip zsh
## Needed only for specific kind of assessments
# RUN apt-get update install -y binwalk exploitdb exploitdb-bin-sploits ldap-utils metasploit-framework nfs-common smbclient smbmap
# Create the base folder of all tools
RUN mkdir /tools
# Install utility scripts
COPY scripts /tools/scripts
# Install utility templates
COPY templates /tools/templates
# Install static binaries folder
COPY static-binaries /tools/static-binaries
# Install docs folder
COPY docs /tools/docs
# Install misc folder
COPY misc /tools/misc
# Install dictionaries
COPY dictionaries /tools/dictionaries
# Install tools and extra materials
COPY beef /tools/beef-conf
COPY build /tmp/build
RUN for f in $(ls /tmp/build/*.sh); do chmod +x $f;bash $f; done
# Generate "requirements.txt" file for custom python scripts
RUN cd /tools/scripts;pipreqs . --force
# Install dependencies via PIP for tools as well as custom scripts
RUN BUILD_LIB=1 pip3 install ssdeep
RUN for f in $(ls /tools/*/requirements.txt); do pip3 install -r $f; done
RUN tldextract --update
# Misc
RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
# Set execute access right
RUN chmod -R +x /tools/
# Build the local favicon DB
RUN mkdir /tools/favicon-db;cd /tools/favicon-db;bash /tools/scripts/generate-favicon-db.sh
# Set final settings of the toolbox
RUN cd /tools/dirsearch; pip3 install .
RUN cd /tools/jwt-tool; python3 jwt_tool.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJsb2dpbiI6InRpY2FycGkifQ.bsSwqj2c2uI9n7-ajmi3ixVGhPUiY7jO9SUn9dm15Po; echo 0
RUN cd /tools/jwt-tool; python3 jwt_tool.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJsb2dpbiI6InRpY2FycGkifQ.bsSwqj2c2uI9n7-ajmi3ixVGhPUiY7jO9SUn9dm15Po; echo 0
RUN /tools/kiterunner/kr scan http://righettod.eu/api -q -A=apiroutes-210328:10 --fail-status-codes 404 --preflight-depth 1
RUN date > /root/image-build-datetime
RUN echo "export PATH=$PATH:/tools/scripts:/root/go/bin" >> /root/.zshrc
RUN echo "export NUCLEI_TPL_HOME=/root/nuclei-templates" >> /root/.zshrc
RUN echo "alias list-http-scripts-nmap='ls /usr/share/nmap/scripts/http-*'" >> /root/.zshrc
RUN echo "alias scan-nmap='nmap -Pn --script http-trace,http-waf-detect,http-waf-fingerprint,http-favicon --open'" >> /root/.zshrc
RUN echo "alias get-image-info='echo \"Image build datetime: $(cat /root/image-build-datetime)\"'" >> /root/.zshrc
RUN echo "alias find-nuclei-templates='find /root/nuclei-templates -iname'" >> /root/.zshrc
RUN echo "alias check-tls='bash /tools/testssl/testssl.sh -s -p -U --quiet '" >> /root/.zshrc
RUN touch /root/.hushlogin
# Setup SSH server for remove access
RUN echo "...:::TOOLBOX:::..." > /etc/motd
RUN rm -rf /etc/ssh/ssh_host_*
RUN dpkg-reconfigure openssh-server
COPY ssh-public-key.pem /root/.ssh/ 
RUN mv /root/.ssh/ssh-public-key.pem /root/.ssh/authorized_keys
RUN chmod -R 700 /root/.ssh;mkdir -p /run/sshd;sshd -t
# Final cleanup
RUN rm -rf /tmp/*
WORKDIR /tools
VOLUME /tools/reports
EXPOSE 80
EXPOSE 443
EXPOSE 22
CMD ["/usr/sbin/sshd","-e","-D"]
