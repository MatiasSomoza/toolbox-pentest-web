#!/bin/bash
###
# Cf https://github.com/ffuf/ffuf#usage
# Use -fl X to skip responses with X number of lines
#     -fs X to skip responses with a response size of X bytes
#     -fw X to skip responses with X words
###
EXTRA_FFUF_OPTS=""
COOKIES="a=b"
AUTHENTICATION_HEADER="X-Origin: ABC"
PROXY=""
DICT_HOME="/tools/sec-lists/Discovery/Web-Content"
IGNORE_HTTP_CODES="302,404"
THREAD_COUNT="10"
###
if [ "$PROXY" != "" ];
then
	ffuf_proxy="-x $PROXY"
else
	ffuf_proxy=""
fi
base_target=$1
# Cf https://github.com/ffuf/ffuf#usage
opts="$EXTRA_FFUF_OPTS $ffuf_proxy -fc $IGNORE_HTTP_CODES -c -ic -timeout 30 -t $THREAD_COUNT "
dicts=("graphql.txt" "swagger.txt" "spring-boot.txt" "axis.txt" "api/actions-lowercase.txt")
http_methods=("INVALID" "OPTIONS" "HEAD" "POST" "PUT" "DELETE" "TRACE" "PURGE" "PROPFIND" "PROPPATCH" "MKCOL" "COPY" "MOVE" "LOCK" "UNLOCK" "VERSION-CONTROL" "REPORT" "CHECKOUT" "CHECKIN" "UNCHECKOUT" "MKWORKSPACE" "UPDATE" "LABEL" "MERGE" "BASELINE-CONTROL" "MKACTIVITY" "ORDERPATCH" "ACL" "PATCH" "SEARCH" "ARBITRARY" "BIND" "LINK" "MKCALENDAR" "MKREDIRECTREF" "PRI" "QUERY" "REBIND" "UNBIND" "UNLINK" "UPDATEREDIRECTREF")
for dict in ${dicts[@]}; do
	entries_count=$(wc -l $DICT_HOME/$dict | cut -d' ' -f1)
	echo -e "\e[93m[+] Test using '$dict' ($entries_count entries) ...\e[0m"
	ffuf $opts -w $DICT_HOME/$dict -b "$COOKIES" -H "$AUTHENTICATION_HEADER" -u $base_target/FUZZ	
	if [ "$dict" == "api/actions-lowercase.txt" ];
	then
		# Try using different HTTP methods than GET
		for http_method in ${http_methods[@]}; do
			echo -e "\e[93m[+] Test using '$dict' ($entries_count entries) with HTTP method '$http_method' ...\e[0m"
			ffuf -X $http_method -H "Content-Type: application/json" $opts -b "$COOKIES" -H "$AUTHENTICATION_HEADER" -w $DICT_HOME/$dict -u $base_target/FUZZ
		done
	fi
done
