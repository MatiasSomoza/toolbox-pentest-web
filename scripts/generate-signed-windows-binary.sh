#!/bin/bash
#################################################################
# Script to steal the signature of a signed Windows binary file
# to sign a provided arbitrary Windows binary file.
#
# Requirement sotware:
#   https://github.com/secretsquirrel/SigThief
#	https://docs.microsoft.com/en-us/sysinternals/downloads/procmon
#################################################################
if [ "$#" -lt 1 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [WINDOWS_BINARY_FILE_TO_SIGN]"
    echo ""
    echo "Call example:"
    echo "    $script_name my-program.exe"
    exit 1
fi
echo "[+] Sign '$1'..."
python3 /tools/sig-thief/sigthief.py -i Procmon.exe -t $1 -o /tmp/signed-$1 | grep -v "Like the software" | grep -v -e '^$'
echo "[+] Check signature of '/tmp/signed-$1'..."
python3 /tools/sig-thief/sigthief.py -i /tmp/signed-$1 -c | grep -v "Like the software" | grep -v -e '^$'
echo "[+] Display type..."
file $1
file /tmp/signed-$1