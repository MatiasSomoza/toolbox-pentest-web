#!/bin/bash
###########################################################
# Script to generate hashes of all the private keys stored
# in a Java KeyStore (JKS) file to recover them with hashcat
# 
# Sources:
# https://github.com/floyd-fuh/JKS-private-key-cracker-hashcat
# https://cryptosense.com/blog/cracking-java-keystores-with-hashcat
###########################################################
if [ "$#" -lt 1 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [JKS_FILE]"
    echo ""
    echo "Call example:"
    echo "    $script_name test.jks"
    exit 1
fi
JKS_FILE=$1
HASHES_FILE="/tools/reports/jks-pkeys-hashes.txt"
TOOL_HOME="/tools/prepare-jks-for-hashcat-cracking/"
CDIR=$(pwd)
echo -e "\e[93m[+] Compile JksPrivkPrepare...\e[0m"
cd $TOOL_HOME/JksPrivkPrepare
javac JksPrivkPrepare.java
jar cfe JksPrivkPrepare.jar JksPrivkPrepare *.class
rm *.class
mv JksPrivkPrepare.jar ..
echo -e "\e[93m[+] Generate hashes to file '$HASHES_FILE'...\e[0m"
cd $CDIR
java -jar $TOOL_HOME/JksPrivkPrepare.jar $JKS_FILE > $HASHES_FILE
ls -l $HASHES_FILE
cat $HASHES_FILE
echo -e "\e[93m[+] Hashcat command hint...\e[0m"
echo "hashcat -m 15500 -a 3 jks-pkeys-hashes.txt ?l?l?l?l?l?l"
