#!/bin/bash
###########################################################################################################
# Script retrieving the description of a JWT claim name using the online RFC below:
# https://www.iana.org/assignments/jwt/jwt.xml
#
# System dependencies to install via the package manager:
#   apt install curl
###########################################################################################################
if [ "$#" -lt 1 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [CLAIM_NAME_IN_LOWER_CASE]"
    echo ""
    echo "Call example:"
    echo "    $script_name iss"
    exit 1
fi
claim=$1

function write_step (){
    echo -e "\e[93m[+] $1\e[0m"
}

function render_description (){
    echo $1 | cut -d',' -f2 | tr -d '"'
} 

echo -e "\e[36m[i] See details on https://www.iana.org/assignments/jwt/jwt.xml \e[0m"
write_step "Search in 'JSON Web Token Claims' CSV file..."
claim_desc=$(curl -sk https://www.iana.org/assignments/jwt/claims.csv | grep -iE "^$claim,")
if [ "$claim_desc" == "" ];
then
    echo "Not found."
    write_step "Search in 'JWT Confirmation Methods' CSV file..."
    claim_desc=$(curl -sk https://www.iana.org/assignments/jwt/confirmation-methods.csv | grep -iE "^$claim,")
    if [ "$claim_desc" == "" ];
    then
        echo "Not found."
    else
        render_description "$claim_desc"
    fi
else
    render_description "$claim_desc"
fi