#!/bin/bash
maindomain=$1
echo -e "\e[93m[+] Lookup in Certificate Transparency log...\e[0m"
curl -sk "https://crt.sh/?q=$maindomain&output=json" | jq -r ".[].name_value" | grep -v "*" | sort -u > /tmp/subdomains1.txt
wc -l /tmp/subdomains1.txt
echo -e "\e[93m[+] Discover via GoBuster with SecLists DNS dictionaries...\e[0m"
gobuster -z -q -w /tools/sec-lists/Discovery/DNS/fierce-hostlist.txt dns --wildcard -d $maindomain > /tmp/subdomains2.txt
cat /tmp/subdomains2.txt | sed "s/Found: //g" | sed "s/\r//g" | sed "s/[[:space:]]*$//" | sort -u > /tmp/subdomains22.txt
mv /tmp/subdomains22.txt /tmp/subdomains2.txt
wc -l /tmp/subdomains2.txt
echo -e "\e[93m[+] Discover via SubFinder default sources...\e[0m"
subfinder -disable-update-check -silent -d $maindomain -o /tmp/subdomains3.txt
wc -l /tmp/subdomains.txt
echo -e "\e[93m[+] Filter final results...\e[0m"
cat /tmp/subdomains1.txt /tmp/subdomains2.txt /tmp/subdomains3.txt | sort -u > /tmp/subdomains.txt
rm /tmp/subdomains1.txt /tmp/subdomains2.txt /tmp/subdomains3.txt
wc -l /tmp/subdomains.txt
echo -e "\e[93m[+] Verify identified domains validity via Dig...\e[0m"
dig A +multiline +noall +answer +nocmd -f /tmp/subdomains.txt | awk '{printf "%-40s %s\n", $1, $5}'
