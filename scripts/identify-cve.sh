#!/bin/bash
############################################################################
# Script to identify a product's CVE based on information provided by
# https://vulmon.com/

# Choose sorting method 
sort_method="byriskscore" # byrelevance | byriskscore |  bydate |  byactivity
############################################################################
if [ "$#" -lt 1 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [SEARCH_TERM]"
    echo ""
    echo "Call example:"
    echo "    $script_name 'apache tomcat 7.5.22'"
    exit 1
fi
terms=$(echo "$1" | tr " " +)
work_file="/tmp/work.tmp"
echo -e "\e[93m[+] Extract the list of CVE\e[0m"
echo "https://vulmon.com/searchpage?q=$terms&sortby=$sort_method"
curl -sk "https://vulmon.com/searchpage?q=$terms&sortby=$sort_method" | grep -Po "/vulnerabilitydetails\?qid=CVE-[0-9]{4}-[0-9]+" | uniq > $work_file
found=$(wc -l $work_file | cut -d' ' -f1)
if [ "$found" == "0" ];
then
  echo "No CVE found for the search terms: '$terms'."
  exit 0
else 
  echo "$found CVE founds."
fi
echo -e "\e[93m[+] Extract CVE CVSS 2/3 score\e[0m"
while IFS= read -r line
do
  score=$(curl -sk "https://vulmon.com$line" | grep -Po "CVSS v(2|3) Base Score: [0-9\.]+")
  cve=$(echo $line | cut -d'=' -f2)
  echo "[$cve]"
  echo "$score"
done < "$work_file"
