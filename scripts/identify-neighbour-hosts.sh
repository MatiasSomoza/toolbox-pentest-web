#!/bin/bash
# Script used to identify neighbour hosts that are reacheable via IPV4 and IPV6.
# Matching is performed based on the MAC address.
# Useful when ports are blocked/filtered for IPV4 but not for IPV6.
INTERFACE=$1
# Send a ping to IPV6 multicast addresses (all nodes + all routers)
ping6 -c 5 -I $INTERFACE ff02::1
ping6 -c 5 -I $INTERFACE ff02::2
# Send a ping to the broadcast address (IPV4) of the interface
broadcast=`ip -4 addr show $INTERFACE | grep -oP '(?<=brd\s)\d+(\.\d+){3}'`
ping -b -c 5 -I $INTERFACE $broadcast 
# Get the list of known neighbours IPV6 addresses with their MAC addresses
ip -6 neighbour | cut -d' ' -f1,5 > /tmp/IP.txt
# Get the list of known neighbours IPV4 addresses with their MAC addresses
sudo arp -i $INTERFACE -an | cut -d' ' -f2,4 >> /tmp/IP.txt
# Render the result
echo "IP MAC" > /tmp/IPSorted.txt
sort -k 2 /tmp/IP.txt >> /tmp/IPSorted.txt
cat /tmp/IPSorted.txt | tr -d '()' > /tmp/IP.txt
column -t -s " " /tmp/IP.txt
rm /tmp/IP.txt /tmp/IPSorted.txt
