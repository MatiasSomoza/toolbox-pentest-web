import json
import colorama
import sys
from termcolor import colored
from tabulate import tabulate

'''
Quick script to format the result of a Gitleaks JSON report:
    gitleaks -p /tmp/work/my-git-repo-folder -c gitleaks-custom-config.toml -o report.json
    python generate-report-gitleaks.py report.json

Dependencies:
    pip install tabulate colorama termcolor
'''

report = sys.argv[1]
colorama.init()
with open(report) as f:
    content = f.read()
leaks = json.loads(content)
table_rows = []
keys = []
for leak in leaks:
    key = leak["line"]
    if key not in keys:
        table_rows.append([leak["date"], leak["file"], leak["commit"], leak["line"]])
        keys.append(key)
table_headers = ["Date", "File", "Commit", "Line"]
table_rows.sort()
print(colored(f"[+] Leaks ({len(table_rows)} found):", "yellow"))
print(tabulate(table_rows, headers=table_headers))
