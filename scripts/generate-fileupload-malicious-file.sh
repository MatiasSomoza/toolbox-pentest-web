#!/bin/bash
###########################################################################################################
# Script to create a file containing a release of the Netcat tool encoded in Base64.
# As Netcat is detected by Anti-Virus then, it is used to test if a file upload, accepting text data,
# verify if the data is a binary file encoded and then scan it with an Anti-Virus.
#
# References:
#	https://eternallybored.org/misc/netcat/
#	https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip
###########################################################################################################
###
# Utilities functions
function write_step(){
    echo -e "\e[93m[+] $1\e[0m"
}
# Constants
NETCAT_FILE="/tools/static-binaries/windows/netcat/nc.exe"
RESULT_FILE="/tools/reports/netcat-b64.txt"
WORK_FILE="/tmp/decoded.bin"
# Entry point
write_step "Encode the Netcat release file..."
base64 -w0 $NETCAT_FILE > $RESULT_FILE
echo "Ok."
write_step "Verify the encoded file..."
cat $RESULT_FILE | base64 -d > $WORK_FILE 2>/dev/null
hash_original=$(sha256sum $NETCAT_FILE | cut -d' ' -f1)
hash_decoded=$(sha256sum $WORK_FILE | cut -d' ' -f1)
if [ "$hash_original" != "$hash_decoded" ]
then
	echo "Error during the encoding!"
	exit -1
fi
echo "Ok."
write_step "Hashes:"
sha256sum $NETCAT_FILE
sha256sum $RESULT_FILE
write_step "File type:"
file $NETCAT_FILE
file $RESULT_FILE
write_step "VirusTotal report URL:"
hash=$(sha256sum $NETCAT_FILE | cut -d' ' -f1)
echo "https://www.virustotal.com/gui/file/$hash"
rm $WORK_FILE
