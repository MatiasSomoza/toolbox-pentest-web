#!/bin/bash
###########################################################################################################
# Script to identify folders containing samples content.
# Precisely identify folders containing examples stuff that should not be normally deployed.
#
# For example, it can be used to check if "samples" folders present in a CMS distribution bundle 
# are deployed on the targeted instance.
#
# The script use the code base as reference for the initial identification of folders base path.
#
# System dependencies to install via the package manager:
#   wfuzz
###########################################################################################################
if [ "$#" -lt 2 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [CODE_BASE_ABSOLUTE_PATH] [BASE_URL_WITHOUT_ENDING_SLASH]"
    echo ""
    echo "Call example:"
    echo "    $script_name /tmp/drupal https://mysite.com"
    exit 1
fi
cdir=$(pwd)
codebase=$1
baseurl=$2
work="$cdir/list.tmp"
echo -e "\e[104m[+] Identify samples folders in code base...\e[0m"
cd $codebase
find . -type d -iname "sample*" | cut -c 2- > $work
find . -type d -iname "example*" | cut -c 2- >> $work
cd $cdir
if [ ! -s "$work" ]; then
	echo "No entry found!"
else
	wc -l $work | cut -d' ' -f1
	echo -e "\e[104m[+] Check content presence...\e[0m"
	wfuzz -L -c -w $work --hc 400,404 "$baseurl/FUZZ"
fi
rm $work
